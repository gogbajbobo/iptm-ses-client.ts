<script lang='ts'>

    import { defineComponent, computed, ref } from 'vue'
    import { useStore } from 'vuex'
    import { ActionTypes, GetterTypes } from '@/store/examinees/types'
    import { UserType } from '@/store/interfaces'
    import ExamineeForm from '@/components/ExamineeForm.vue'

    const localname = 'Пользователи'

    export default defineComponent({

        name: 'ExamineeList',
        localname,

        components: { ExamineeForm },

        setup() {

            const store = useStore()
            const examinees = computed(() => store.getters[`examinees/${ GetterTypes.EXAMINEE_LIST }`])
            const getExaminees = () => store.dispatch(`examinees/${ ActionTypes.GET_EXAMINEES }`)
            getExaminees().catch(() => {})

            let examineeFormVisible = ref(false)
            let selectedExaminee: any = null

            return {
                localname,
                examinees,
                examineeFormVisible,
                selectedExaminee,
            }

        },

        methods: {

            editExamineeButtonPressed(examinee: UserType) {

                this.selectedExaminee = examinee
                this.examineeFormVisible = true

            },

        },

    })

</script>

<template>

    <div>

        <div>
            {{ localname }}
        </div>

        <el-table :data="examinees">

            <el-table-column
                type="index"
                width="50">
            </el-table-column>

            <el-table-column
                prop="id"
                label="#"
                width="180">
            </el-table-column>

            <el-table-column
                prop="username"
                label="Имя">
            </el-table-column>

            <el-table-column
                prop="categories"
                label="Категории">
            </el-table-column>

            <el-table-column>
                <template #default="scope">

                    <el-button type='warning'
                               plain
                               @click='editExamineeButtonPressed(scope.row)'>Редактировать</el-button>

                </template>
            </el-table-column>

        </el-table>

        <el-dialog title="Пользователь"
                   :model-value="examineeFormVisible"
                   width="30%">

            <ExamineeForm :examinee='selectedExaminee'></ExamineeForm>

            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="examineeFormVisible = false">Отменить</el-button>
                    <el-button type="primary" @click="examineeFormVisible = false">Сохранить</el-button>
                </span>
            </template>

        </el-dialog>

    </div>

</template>

<style scoped>

</style>
